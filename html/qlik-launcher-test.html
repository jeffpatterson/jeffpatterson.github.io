
<html>
  <head>
    <title>Darwin / Qlik Stage Test</title>
    <style>
      #customLauncher {
        position: fixed;
        bottom: 25px;
        right: 25px;
        width: 80px;
        height: 80px;
        background-image: url(https://www.qlik.com/us/-/media/images/global-us/Resource-Library/Custom/driftbot_graphic_circle.jpg);
        background-size: 80px 80px;
        z-index:2147483001;
        border-radius: 40px;
        cursor: pointer;
      }

      #customLauncher.hide {
        display: none;
      }

    </style>
  </head>
  <body>
    <script>
    const rendered = {}
    // Functions used to render the Meya lifecycle logs on the side panel
    function onEventStream(eventStream) {
      for(const event of [...eventStream.events].reverse()) {
        if(!rendered[event.id]) {
          render(event, eventStream)
          rendered[event.id] = true
        }
      }
    }

    function render(event, eventStream) {
      console.log(event)
      if(event.type === "meya.session.event.chat.close") {
        document.getElementById("customLauncher").classList.remove("hide");
      } else if (event.type === "meya.session.event.chat.open") {
        document.getElementById("customLauncher").classList.add("hide");
      }
    }

    window.orbConfig = {
        connectionOptions: {
            gridUrl: "https://grid.meya.ai",
            appId: "app-5d25cf848e834f8699cd7a80aaada26c",
            integrationId: "integration.orb",
            connect: false,
            pageContext: {
                environment: "STAGE"
            },
            onFirstConnect: (connectData, next) => {
              orb.addListener("eventStream", onEventStream);
              next();
            }
        },
        theme: {
            brandColor: "#009845",
            botAvatarUrl: "https://www.qlik.com/us/-/media/images/global-us/Resource-Library/Custom/driftbot_graphic_circle.jpg"
        },
        launcher: {
            type: "orb",
        },
        windowApi: true,
    };
    document.head.appendChild(document.createElement("style")).innerHTML = "h1.Title-sc-l0esa5{margin-top:revert;}";
    (function(){
        var script = document.createElement("script");
        script.type = "text/javascript";
        script.async = true;
        script.src = "https://cdn.meya.ai/v2/orb.js";
        document.body.appendChild(script);
        var fontStyleSheet = document.createElement("link");
        fontStyleSheet.rel = "stylesheet";
        fontStyleSheet.href = "https://cdn.meya.ai/font/inter.css";
        document.body.appendChild(fontStyleSheet);
    })();
</script>
<div id="customLauncher" onclick="orb.openChat();"></div>
  </body>
</html>
