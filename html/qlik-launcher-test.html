
<html>
  <head>
    <title>Darwin / Qlik Stage Test</title>
    <style>



    </style>
  </head>
  <body>
    <script>
    const rendered = {}
    function onEventStream(eventStream) {
      for(const event of [...eventStream.events].reverse()) {
        if(!rendered[event.id]) {
          render(event, eventStream)
          rendered[event.id] = true
        }
      }
    }

    function render(event, eventStream) {
      if(event.type === "meya.session.event.chat.close") {
        document.getElementById("customLauncher").style.display = "block";
      } else if (event.type === "meya.session.event.chat.open") {
        document.getElementById("customLauncher").style.display = "none";
      }
    }

    document.addEventListener("DOMContentLoaded", function() {
      var launcherDiv = document.createElement("div");
      launcherDiv.setAttribute("id", "customLauncher");
      launcherDiv.style.position = "fixed";
      launcherDiv.style.bottom = "25px";
      launcherDiv.style.right = "25px";
      launcherDiv.style.width = "80px";
      launcherDiv.style.height = "80px";
      launcherDiv.style.backgroundImage = "url(https://www.qlik.com/us/-/media/images/global-us/Resource-Library/Custom/driftbot_graphic_circle.jpg)";
      launcherDiv.style.backgroundSize = "80px 80px";
      launcherDiv.style.zIndex = "2147483001";
      launcherDiv.style.borderRadius = "40px";
      launcherDiv.style.cursor = "pointer";
      launcherDiv.addEventListener("click",function() { orb.openChat();});
      document.body.appendChild(launcherDiv);

      const mediaQuery = window.matchMedia('(min-width: 676px) and (min-height: 686px)');
      function positionLauncher(e) {
        if (e.matches) {
          document.getElementById("customLauncher").style.bottom = "25px";
          document.getElementById("customLauncher").style.right = "25px";
        } else {
          document.getElementById("customLauncher").style.bottom = "10px";
          document.getElementById("customLauncher").style.right = "10px";
        }
      }
      mediaQuery.addListener(positionLauncher);
      positionLauncher(mediaQuery);
    });

    window.orbConfig = {
        connectionOptions: {
            gridUrl: "https://grid.meya.ai",
            appId: "app-5d25cf848e834f8699cd7a80aaada26c",
            integrationId: "integration.orb",
            connect: false,
            pageContext: {
                environment: "STAGE"
            },
            onFirstConnect: (connectData, next) => {
              orb.addListener("eventStream", onEventStream);
              next();
            }
        },
        theme: {
            brandColor: "#009845",
            botAvatarUrl: "https://www.qlik.com/us/-/media/images/global-us/Resource-Library/Custom/driftbot_graphic_circle.jpg"
        },
        launcher: {
            type: "orb",
        },
        windowApi: true,
    };
    document.head.appendChild(document.createElement("style")).innerHTML = "h1.Title-sc-l0esa5{margin-top:revert;}";
    (function(){
        var script = document.createElement("script");
        script.type = "text/javascript";
        script.async = true;
        script.src = "https://cdn.meya.ai/v2/orb.js";
        document.body.appendChild(script);
        var fontStyleSheet = document.createElement("link");
        fontStyleSheet.rel = "stylesheet";
        fontStyleSheet.href = "https://cdn.meya.ai/font/inter.css";
        document.body.appendChild(fontStyleSheet);
    })();
</script>
  </body>
</html>
